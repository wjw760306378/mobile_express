(function(e){function t(t){for(var a,o,c=t[0],s=t[1],l=t[2],u=0,d=[];u<c.length;u++)o=c[u],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&d.push(r[o][0]),r[o]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);h&&h(t);while(d.length)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(a=!1)}a&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},o={app:0},r={app:0},i=[];function c(e){return s.p+"js/"+({}[e]||e)+"."+{"chunk-3f4155bf":"6efd408e","chunk-653dbbf4":"01372a15","chunk-e4665138":"39f298ea","chunk-1ec866fb":"3f20bed4","chunk-30c523ec":"72406711","chunk-adcbf916":"816740e8","chunk-b70a7408":"ecd095d6","chunk-f95303b4":"a53dd70b"}[e]+".js"}function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(e){var t=[],n={"chunk-3f4155bf":1,"chunk-653dbbf4":1,"chunk-e4665138":1,"chunk-1ec866fb":1,"chunk-30c523ec":1,"chunk-adcbf916":1,"chunk-b70a7408":1,"chunk-f95303b4":1};o[e]?t.push(o[e]):0!==o[e]&&n[e]&&t.push(o[e]=new Promise((function(t,n){for(var a="css/"+({}[e]||e)+"."+{"chunk-3f4155bf":"ae04e547","chunk-653dbbf4":"db178454","chunk-e4665138":"21f66f56","chunk-1ec866fb":"0a63485b","chunk-30c523ec":"3764250b","chunk-adcbf916":"8f06b450","chunk-b70a7408":"5115b384","chunk-f95303b4":"2b6eb7a4"}[e]+".css",r=s.p+a,i=document.getElementsByTagName("link"),c=0;c<i.length;c++){var l=i[c],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===a||u===r))return t()}var d=document.getElementsByTagName("style");for(c=0;c<d.length;c++){l=d[c],u=l.getAttribute("data-href");if(u===a||u===r)return t()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=t,h.onerror=function(t){var a=t&&t.target&&t.target.src||r,i=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=a,delete o[e],h.parentNode.removeChild(h),n(i)},h.href=r;var p=document.getElementsByTagName("head")[0];p.appendChild(h)})).then((function(){o[e]=0})));var a=r[e];if(0!==a)if(a)t.push(a[2]);else{var i=new Promise((function(t,n){a=r[e]=[t,n]}));t.push(a[2]=i);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,s.nc&&u.setAttribute("nonce",s.nc),u.src=c(e);var d=new Error;l=function(t){u.onerror=u.onload=null,clearTimeout(h);var n=r[e];if(0!==n){if(n){var a=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+a+": "+o+")",d.name="ChunkLoadError",d.type=a,d.request=o,n[1](d)}r[e]=void 0}};var h=setTimeout((function(){l({type:"timeout",target:u})}),12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(t)},s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var h=u;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"37c7":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("66b9");var a=n("b650"),o=(n("4467"),n("c36e")),r=(n("2994"),n("2bdd")),i=(n("ab71"),n("58e6")),c=(n("0cc8"),n("3104")),s=(n("66cf"),n("343b")),l=(n("4b0a"),n("2bb1")),u=(n("7844"),n("5596")),d=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("2b0e")),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"main"},[n("transition",{attrs:{name:e.transitionName},on:{"after-enter":e.afterEnter}},[n("keep-alive",{attrs:{include:e.keepAliveRoute}},[n("router-view",{ref:"rv"})],1)],1)],1),n("transition",{attrs:{name:e.transitionName}},[n("tab-bar",{directives:[{name:"show",rawName:"v-show",value:e.$route.meta.isShowTarBar,expression:"$route.meta.isShowTarBar"}]})],1)],1)},p=[],f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tab-bar"},[n("ul",[n("router-link",{attrs:{to:{name:"index"},tag:"li"}},[e._v(" 首页 ")]),n("router-link",{attrs:{to:{name:"findBook"},tag:"li"}},[e._v(" 发现 ")]),n("router-link",{attrs:{to:{name:"personal"},tag:"li"}},[e._v(" 我的 ")])],1)])},m=[],g={data:function(){return{currentTab:"index"}},methods:{}},b=g,v=(n("d2ea"),n("0c7c")),k=Object(v["a"])(b,f,m,!1,null,null,null),w=k.exports,y={data:function(){return{transitionName:"slide-right",tarbartransition:"",keepAliveRoute:["index","findBook","personal"]}},created:function(){var e=this;setTimeout((function(){e.tarbartransition="slide-left"}),2e3)},components:{tabBar:w},watch:{$route:function(e,t){console.log("to",e,"from",t),e.meta.index>t.meta.index?this.transitionName="slide-left":this.transitionName=e.meta.index<t.meta.index?"slide-right":"",console.log("this.transitionName",this.transitionName)}},methods:{afterEnter:function(){void 0!==this.$refs.rv.searchTop&&(this.$refs.rv.searchTop="",this.$refs.rv.sortTop="")}}},O=y,E=(n("5c0b"),Object(v["a"])(O,h,p,!1,null,null,null)),x=E.exports,B=(n("d3b7"),n("8c4f"));d["a"].use(B["a"]);var _=[{path:"/",name:"index",component:function(){return Promise.all([n.e("chunk-e4665138"),n.e("chunk-30c523ec")]).then(n.bind(null,"37f9"))},meta:{isShowTarBar:!0,index:1}},{path:"/findBook",name:"findBook",component:function(){return n.e("chunk-3f4155bf").then(n.bind(null,"9cc7"))},meta:{isShowTarBar:!0,index:1}},{path:"/personal",name:"personal",component:function(){return Promise.all([n.e("chunk-e4665138"),n.e("chunk-f95303b4")]).then(n.bind(null,"ff23"))},meta:{isShowTarBar:!0,index:1}},{path:"/login",name:"login",component:function(){return Promise.all([n.e("chunk-e4665138"),n.e("chunk-b70a7408")]).then(n.bind(null,"dc3f"))},meta:{isShowTarBar:!1,index:2}},{path:"/setPersonal",name:"setPersonal",component:function(){return n.e("chunk-653dbbf4").then(n.bind(null,"7c77"))},meta:{isShowTarBar:!1,index:2}},{path:"/collect",name:"collect",component:function(){return Promise.all([n.e("chunk-e4665138"),n.e("chunk-adcbf916")]).then(n.bind(null,"b5ba"))},meta:{isShowTarBar:!1,index:2}},{path:"/detailBook",name:"detailBook",component:function(){return Promise.all([n.e("chunk-e4665138"),n.e("chunk-1ec866fb")]).then(n.bind(null,"8d0d"))},meta:{isShowTarBar:!1,index:2}}],S=new B["a"]({mode:"history",linkExactActiveClass:"active",routes:_}),j=S,R=n("2f62"),T={token:window.localStorage.getItem("token")||"",user:JSON.parse(window.localStorage.getItem("user"))||{}},C={setToken:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.token=t},setUser:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.user=t}},L={namespaced:!0,state:T,mutations:C};d["a"].use(R["a"]);var P=new R["a"].Store({state:{},mutations:{},actions:{},modules:{loginState:L}}),I=(n("a24a"),n("499a"),n("242e")),U=n.n(I),N=n("ca95"),A=n.n(N),F=n("fe3c"),M=n.n(F),$=n("bc3a"),q=n.n($),D=L.state.token;function z(e){return new Promise((function(t,n){q()({method:"get",url:e}).then((function(e){t(e.data)})).catch((function(e){n(e)}))}))}function V(e,t){return console.log("urll",e),new Promise((function(n,a){q()({method:"post",url:e,data:t}).then((function(e){n(e.data)})).catch((function(e){a(e)}))}))}q.a.defaults.baseURL="",q.a.defaults.timeout=12e4,q.a.interceptors.request.use((function(e){return console.log("token",D),D&&(e.headers.Authorization=D),e}),(function(e){return Promise.reject(e)})),q.a.interceptors.response.use((function(e){return e}),(function(e){if(e.response)switch(e.response.status){case 401:case 400:e.message="请求错误";break;case 403:e.message="拒绝访问";break;case 404:console.log("404"),e.message="请求地址出错: ".concat(e.response.config.url);break;case 408:e.message="请求超时";break;case 500:e.message="服务器内部错误";break;case 501:e.message="服务未实现";break;case 502:e.message="网关错误";break;case 503:e.message="服务不可用";break;case 504:e.message="网关超时";break;case 505:e.message="HTTP版本不受支持";break;default:e.message="连接服务器异常"}else e.message="连接服务器失败";return Promise.reject(e)}));n("99af"),n("cb29"),n("b0c0"),n("ac1f"),n("3ca3"),n("466d"),n("5319"),n("1276"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("ddb0"),n("2b3d");var J=n("ade3"),H=n("3496"),K=n.n(H),W=n("5501"),G=n.n(W),Q={install:function(e){e.prototype.initilize=function(e){var t,n=this;this.options=e,this.createElement(),this.resultObj=e.resultObj,this.cropper=new K.a(this.preview,(t={aspectRatio:e.aspectRatio||1,autoCropArea:e.autoCropArea||.8,viewMode:1,guides:"Free"!=e.aspectRatio,cropBoxResizable:"Free"!=e.aspectRatio,cropBoxMovable:"Free"!=e.aspectRatio,dragCrop:"Free"!=e.aspectRatio,background:!1,checkOrientation:!0,checkCrossOrigin:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!1,rotatable:!0,scalable:!0,center:!0},Object(J["a"])(t,"cropBoxMovable",!0),Object(J["a"])(t,"toggleDragModeOnDblclick",!1),Object(J["a"])(t,"ready",(function(){if("Free"==e.aspectRatio){var t=n.cropper.cropBox;t.querySelector("span.cropper-view-box").style.outline="none",n.cropper.disable()}})),t))},e.prototype.createElement=function(){this.preview=null;var e='<div><img id="clip_image" src="originUrl"></div><button type="button" id="cancel_clip">取消</button><button type="button" id="button_rotate">旋转</button><button type="button" id="clip_button">确定</button>';e+='<div class="crop_loading"><div class="crop_content"><img src="./loading.gif"><div class="crop_text">图片上传中</div></div></div>',e+='<div class="crop_success"><div class="crop_success_text">上传成功</div></div></div>';var t=document.getElementsByTagName("body")[0];this.reagion=document.createElement("div"),this.reagion.id="clip_container",this.reagion.className="container",this.reagion.innerHTML=e,t.appendChild(this.reagion),this.preview=document.getElementById("clip_image"),this.initFunction()},e.prototype.initFunction=function(){var e=this;this.clickBtn=document.getElementById("clip_button"),this.cancelBtn=document.getElementById("cancel_clip"),this.btnRotate=document.getElementById("button_rotate"),this.addEvent(this.clickBtn,"click",(function(){e.crop()})),this.addEvent(this.cancelBtn,"click",(function(){e.destoried()})),this.addEvent(this.btnRotate,"click",(function(){e.cropper.rotate(90)})),this.addEvent(this.fileObj,"click",(function(){this.value=""}))},e.prototype.clip=function(e,t){var n=this;this.fileObj=e.srcElement;var a=e.target.files||e.dataTransfer.files;if(!a.length)return!1;this.initilize(t),this.picValue=a[0],console.log("压缩前this.picValue",this.picValue),G.a.getData(a[0],(function(){n.Orientation=G.a.getTag(a[0],"Orientation"),console.log("Exif,self.Orientation",n.Orientation)})),this.originUrl=this.getObjectURL(this.picValue),console.log("this.originUrl",this.originUrl),this.cropper&&this.cropper.replace(this.originUrl)},e.prototype.getObjectURL=function(e){var t=null;return void 0!=window.createObjectURL?t=window.createObjectURL(e):void 0!=window.URL?t=window.URL.createObjectURL(e):void 0!=window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t},e.prototype.crop=function(){var e,t,n=this,a=new Image;document.querySelector(".crop_loading").style.display="block",setTimeout((function(){e=n.cropper.getCroppedCanvas(),t=n.getRoundedCanvas(e);var o=t.toDataURL();if(console.log("imgData",o,o.length),a.src=o,o.length<102400){n.resultObj.src=o;var r=n.dataURLtoFile(o,n.picValue.name);n.postImg(r,o)}else a.onload=function(){console.log("self.Orientation",n.Orientation);var e=n.compress(a,n.Orientation);n.resultObj.src=e;var t=n.dataURLtoFile(e,n.picValue.name);n.postImg(t,e)}}),20)},e.prototype.getRoundedCanvas=function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),a=e.width,o=e.height;return t.width=a,t.height=o,n.imageSmoothingEnabled=!0,n.drawImage(e,0,0,a,o),n.globalCompositeOperation="destination-in",n.beginPath(),n.rect(0,0,a,o),n.fill(),t},e.prototype.dataURLtoFile=function(e,t){var n=e.split(","),a=n[0].match(/:(.*?);/)[1],o=atob(n[1]),r=o.length,i=new Uint8Array(r);while(r--)i[r]=o.charCodeAt(r);return new File([i],t,{type:a})},e.prototype.destoried=function(){this.removeEvent(this.clickBtn,"click",null),this.removeEvent(this.btnRotate,"click",null),this.removeEvent(this.cancelBtn,"click",null),this.removeEvent(this.fileObj,"click",null),this.reagion.parentNode.removeChild(this.reagion),this.cropper.destroy(),this.cropper=null},e.prototype.postImg=function(e,t){var n=this,a=JSON.parse(window.localStorage.getItem("user")),o=new FormData,r={headers:{"Content-Type":"multipart/form-data"}};o.append("photoImg",e,e.name),o.append("userid",a.id),this.$post("users/savePhoto",o,r).then((function(e){console.log("users/savePhoto",e),0==e.code&&(a.photosrc=e.photosrc,window.localStorage.setItem("user",JSON.stringify(a)),document.querySelector(".crop_loading").style.display="none",document.querySelector(".crop_success").style.display="block",n.destoried())}))},e.prototype.rotateImg=function(e,t,n){var a=0,o=3;if(null!=e){var r=e.height,i=e.width,c=2;null==c&&(c=a),"right"==t?(c++,c>o&&(c=a)):"right2"==t?c=2:(c--,c<a&&(c=o));var s=90*c*Math.PI/180;alert("degree:".concat(s,"       step:").concat(c));var l=n.getContext("2d");switch(c){case 0:n.width=i,n.height=r,l.drawImage(e,0,0,i,r);break;case 1:n.width=r,n.height=i,l.rotate(s),l.drawImage(e,0,-r,i,r);break;case 2:n.width=i,n.height=r,l.rotate(s),l.drawImage(e,-i,-r,i,r);break;case 3:n.width=r,n.height=i,l.rotate(s),l.drawImage(e,-i,0,i,r);break}}},e.prototype.compress=function(e,t){var n,a,o=document.createElement("canvas"),r=o.getContext("2d"),i=document.createElement("canvas"),c=i.getContext("2d"),s=e.src.length,l=e.width,u=e.height;if((n=l*u/4e6)>1?(console.log("大于400万像素"),n=Math.sqrt(n),l/=n,u/=n):n=1,o.width=l,o.height=u,r.fillStyle="#fff",r.fillRect(0,0,o.width,o.height),(a=l*u/1e6)>1){a=~~(Math.sqrt(a)+1);var d=~~(l/a),h=~~(u/a);i.width=d,i.height=h;for(var p=0;p<a;p++)for(var f=0;f<a;f++)c.drawImage(e,p*d*n,f*h*n,d*n,h*n,0,0,d,h),r.drawImage(i,p*d,f*h,d,h)}else r.drawImage(e,0,0,l,u);var m=o.toDataURL("image/jpeg",.1);return console.log("压缩前："+s),console.log("压缩后："+m.length),console.log("压缩率："+~~(100*(s-m.length)/s)+"%"),i.width=i.height=o.width=o.height=0,m},e.prototype.addEvent=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},e.prototype.removeEvent=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)}}};d["a"].use(U.a),d["a"].use(A.a,{name:"v-touch"}),M.a.attach(document.body),d["a"].prototype.$get=z,d["a"].prototype.$post=V,d["a"].use(Q),d["a"].use(u["a"]),d["a"].use(l["a"]),d["a"].use(s["a"]),d["a"].use(c["a"]),d["a"].use(i["a"]),d["a"].use(r["a"]),d["a"].use(o["a"]),d["a"].use(a["a"]),d["a"].config.productionTip=!1,d["a"].directive("focus",{update:function(e){e.focus()}}),new d["a"]({router:j,store:P,render:function(e){return e(x)}}).$mount("#app")},"5c0b":function(e,t,n){"use strict";var a=n("37c7"),o=n.n(a);o.a},9703:function(e,t,n){},a24a:function(e,t,n){},d2ea:function(e,t,n){"use strict";var a=n("9703"),o=n.n(a);o.a}});