(function(e){function t(t){for(var o,a,c=t[0],s=t[1],u=t[2],l=0,d=[];l<c.length;l++)a=c[l],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&d.push(r[a][0]),r[a]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);h&&h(t);while(d.length)d.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,a=1;a<n.length;a++){var c=n[a];0!==r[c]&&(o=!1)}o&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},a={app:0},r={app:0},i=[];function c(e){return s.p+"js/"+({}[e]||e)+"."+{"chunk-0037c0e4":"58e4542b","chunk-26639f37":"2f5cdc80","chunk-33b96729":"321cb5df","chunk-4b6296a1":"bc9b7a12","chunk-86e9206e":"f7d8a49f","chunk-297f718e":"fcd2f54e","chunk-5f6585aa":"50f217e2","chunk-f360c888":"3d1d3bac"}[e]+".js"}function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(e){var t=[],n={"chunk-0037c0e4":1,"chunk-26639f37":1,"chunk-33b96729":1,"chunk-4b6296a1":1,"chunk-86e9206e":1,"chunk-297f718e":1,"chunk-5f6585aa":1,"chunk-f360c888":1};a[e]?t.push(a[e]):0!==a[e]&&n[e]&&t.push(a[e]=new Promise((function(t,n){for(var o="css/"+({}[e]||e)+"."+{"chunk-0037c0e4":"417c6a41","chunk-26639f37":"ae04e547","chunk-33b96729":"6fc84d1c","chunk-4b6296a1":"696421da","chunk-86e9206e":"f2a7244c","chunk-297f718e":"fbccb305","chunk-5f6585aa":"8f06b450","chunk-f360c888":"db178454"}[e]+".css",r=s.p+o,i=document.getElementsByTagName("link"),c=0;c<i.length;c++){var u=i[c],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===o||l===r))return t()}var d=document.getElementsByTagName("style");for(c=0;c<d.length;c++){u=d[c],l=u.getAttribute("data-href");if(l===o||l===r)return t()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=t,h.onerror=function(t){var o=t&&t.target&&t.target.src||r,i=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=o,delete a[e],h.parentNode.removeChild(h),n(i)},h.href=r;var p=document.getElementsByTagName("head")[0];p.appendChild(h)})).then((function(){a[e]=0})));var o=r[e];if(0!==o)if(o)t.push(o[2]);else{var i=new Promise((function(t,n){o=r[e]=[t,n]}));t.push(o[2]=i);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.src=c(e);var d=new Error;u=function(t){l.onerror=l.onload=null,clearTimeout(h);var n=r[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+o+": "+a+")",d.name="ChunkLoadError",d.type=o,d.request=a,n[1](d)}r[e]=void 0}};var h=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(t)},s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var d=0;d<u.length;d++)t(u[d]);var h=l;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"2b56":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a}));var o="mutationA",a="mutationB"},"37c7":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e7e5");var o=n("d399"),a=(n("ac1e"),n("543e")),r=(n("66b9"),n("b650")),i=(n("4467"),n("c36e")),c=(n("2994"),n("2bdd")),s=(n("ab71"),n("58e6")),u=(n("0cc8"),n("3104")),l=(n("66cf"),n("343b")),d=(n("4b0a"),n("2bb1")),h=(n("7844"),n("5596")),p=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("2b0e")),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"main"},[n("transition",{attrs:{name:e.transitionName},on:{"after-enter":e.afterEnter}},[n("keep-alive",{attrs:{include:e.keepAliveRoute}},[n("router-view",{ref:"rv"})],1)],1)],1),n("transition",{attrs:{name:e.transitionName}},[n("tab-bar",{directives:[{name:"show",rawName:"v-show",value:e.$route.meta.isShowTarBar,expression:"$route.meta.isShowTarBar"}]})],1)],1)},m=[],g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tab-bar"},[n("ul",[n("router-link",{attrs:{to:{name:"index"},tag:"li"}},[e._v(" 首页 ")]),n("router-link",{attrs:{to:{name:"findBook"},tag:"li"}},[e._v(" 发现 ")]),n("router-link",{attrs:{to:{name:"personal"},tag:"li"}},[e._v(" 我的 ")])],1)])},b=[],v={data:function(){return{currentTab:"index"}},methods:{}},k=v,w=(n("d2ea"),n("0c7c")),y=Object(w["a"])(k,g,b,!1,null,null,null),O=y.exports,E={data:function(){return{transitionName:"slide-right",tarbartransition:"",keepAliveRoute:["index","findBook","personal"]}},created:function(){var e=this;setTimeout((function(){e.tarbartransition="slide-left"}),2e3)},components:{tabBar:O},watch:{$route:function(e,t){console.log("to",e,"from",t),e.meta.index>t.meta.index?this.transitionName="slide-left":this.transitionName=e.meta.index<t.meta.index?"slide-right":"",console.log("this.transitionName",this.transitionName)}},methods:{afterEnter:function(){void 0!==this.$refs.rv.searchTop&&(this.$refs.rv.searchTop="",this.$refs.rv.sortTop="")}}},S=E,B=(n("5c0b"),Object(w["a"])(S,f,m,!1,null,null,null)),x=B.exports,T=(n("d3b7"),n("8c4f"));p["a"].use(T["a"]);var _,j=[{path:"/",name:"index",component:function(){return Promise.all([n.e("chunk-86e9206e"),n.e("chunk-297f718e")]).then(n.bind(null,"37f9"))},meta:{isShowTarBar:!0,index:1}},{path:"/findBook",name:"findBook",component:function(){return n.e("chunk-26639f37").then(n.bind(null,"9cc7"))},meta:{isShowTarBar:!0,index:1}},{path:"/personal",name:"personal",component:function(){return n.e("chunk-4b6296a1").then(n.bind(null,"ff23"))},meta:{isShowTarBar:!0,index:1}},{path:"/login",name:"login",component:function(){return n.e("chunk-33b96729").then(n.bind(null,"dc3f"))},meta:{isShowTarBar:!1,index:3}},{path:"/setPersonal",name:"setPersonal",component:function(){return n.e("chunk-f360c888").then(n.bind(null,"7c77"))},meta:{isShowTarBar:!1,index:2}},{path:"/collect",name:"collect",component:function(){return Promise.all([n.e("chunk-86e9206e"),n.e("chunk-5f6585aa")]).then(n.bind(null,"b5ba"))},meta:{isShowTarBar:!1,index:2}},{path:"/detailBook",name:"detailBook",component:function(){return n.e("chunk-0037c0e4").then(n.bind(null,"8d0d"))},meta:{isShowTarBar:!1,index:2}}],R=new T["a"]({mode:"history",linkExactActiveClass:"active",routes:j}),C=R,L=n("2f62"),I={token:window.localStorage.getItem("token")||"",user:JSON.parse(window.localStorage.getItem("user"))||{}},P={userId:function(e){return e.user.id}},U={setToken:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.token=t},setUser:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.user=t}},A={_setToken:function(e,t){e.commit,e.dispatch,e.state;console.log(t)}},N={namespaced:!0,state:I,getters:P,mutations:U,actions:A},F=n("ade3"),M=n("2b56"),$={loading:!1},q={trueState:function(e,t){return e.loading},fngetters:function(e,t,n,o){return function(e){return console.log("getters",t),console.log("rootState",n),console.log("rootGetters",o),e}}},D=(_={setLoading:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.loading=t}},Object(F["a"])(_,M["a"],(function(e,t){console.log("mutationA",e,t)})),Object(F["a"])(_,M["b"],(function(e,t){console.log("mutationB",e,t)})),_),z={actionA:function(e,t){e.commit,e.dispatch,e.state;var n=e.rootState,o=e.rootGetters;console.log("actionA",t),console.log("rootState",n),console.log("rootGetters",o)},actionB:function(e,t){var n=e.commit,o=e.dispatch;e.state,e.rootState;return console.log("actionB",t),o("actionA",{name:"我是actionA"}),n(M["b"],{name:"我是mutationB"}),new Promise((function(e,t){setTimeout((function(){o("loginState/_setToken",{name:"我是loginState里的_setToken"},{root:!0}),e("我返回了")}),1e3)}))}},V={namespaced:!0,state:$,getters:q,mutations:D,actions:z};p["a"].use(L["a"]);var J,G=new L["a"].Store({state:{root:"我是root"},getters:{root:function(){return"我是rootGetters"}},mutations:{},actions:{},modules:{loginState:N,loading:V}}),H=(n("a24a"),n("499a"),n("242e")),K=n.n(H),W=n("ca95"),Q=n.n(W),X=n("fe3c"),Y=n.n(X),Z=n("bc3a"),ee=n.n(Z),te=ee.a.create({baseURL:"",timeout:12e4,headers:{accept:"application/json","Content-Type":"application/json"}});function ne(e){return new Promise((function(t,n){te({method:"get",url:e}).then((function(e){t(e.data)})).catch((function(e){n(e)}))}))}function oe(e,t){return console.log("urll",e),new Promise((function(n,o){te({method:"post",url:e,data:t}).then((function(e){n(e.data)})).catch((function(e){o(e)}))}))}te.interceptors.request.use((function(e){return J=N.state.token,console.log("token",J),J&&(e.headers.Authorization=J),e}),(function(e){return Promise.reject(e)})),te.interceptors.response.use((function(e){return e}),(function(e){if(console.log(e),e.response)switch(e.response.status){case 400:e.message="400 请求错误";break;case 401:e.message="401 token验证失败";break;case 403:e.message="403 拒绝访问";break;case 404:console.log("404"),e.message="404 请求地址出错: ".concat(e.response.config.url);break;case 408:e.message="408 请求超时";break;case 500:e.message="500 服务器内部错误";break;case 501:e.message="服务未实现";break;case 502:e.message="网关错误";break;case 503:e.message="服务不可用";break;case 504:e.message="网关超时";break;case 505:e.message="HTTP版本不受支持";break;default:e.message="连接服务器异常"}else e.message="连接服务器失败";return Promise.reject(e)}));n("99af"),n("cb29"),n("b0c0"),n("ac1f"),n("3ca3"),n("466d"),n("5319"),n("1276"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("ddb0"),n("2b3d");var ae=n("bab4"),re=n.n(ae),ie=n("6f45"),ce=n.n(ie),se={install:function(e){e.prototype.initilize=function(e){var t,n=this;this.options=e,this.createElement(),this.resultObj=e.resultObj,this.cropper=new re.a(this.preview,(t={aspectRatio:e.aspectRatio||1,autoCropArea:e.autoCropArea||.8,viewMode:1,guides:"Free"!=e.aspectRatio,cropBoxResizable:"Free"!=e.aspectRatio,cropBoxMovable:"Free"!=e.aspectRatio,dragCrop:"Free"!=e.aspectRatio,background:!1,checkOrientation:!0,checkCrossOrigin:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!1,rotatable:!0,scalable:!0,center:!0},Object(F["a"])(t,"cropBoxMovable",!0),Object(F["a"])(t,"toggleDragModeOnDblclick",!1),Object(F["a"])(t,"ready",(function(){if("Free"==e.aspectRatio){var t=n.cropper.cropBox;t.querySelector("span.cropper-view-box").style.outline="none",n.cropper.disable()}})),t))},e.prototype.createElement=function(){this.preview=null;var e='<div><img id="clip_image" src="originUrl"></div><button type="button" id="cancel_clip">取消</button><button type="button" id="button_rotate">旋转</button><button type="button" id="clip_button">确定</button>';e+='<div class="crop_loading"><div class="crop_content"><img src="./loading.gif"><div class="crop_text">图片上传中</div></div></div>',e+='<div class="crop_success"><div class="crop_success_text">上传成功</div></div></div>';var t=document.getElementsByTagName("body")[0];this.reagion=document.createElement("div"),this.reagion.id="clip_container",this.reagion.className="container",this.reagion.innerHTML=e,t.appendChild(this.reagion),this.preview=document.getElementById("clip_image"),this.initFunction()},e.prototype.initFunction=function(){var e=this;this.clickBtn=document.getElementById("clip_button"),this.cancelBtn=document.getElementById("cancel_clip"),this.btnRotate=document.getElementById("button_rotate"),this.addEvent(this.clickBtn,"click",(function(){e.crop()})),this.addEvent(this.cancelBtn,"click",(function(){e.destoried()})),this.addEvent(this.btnRotate,"click",(function(){e.cropper.rotate(90)})),this.addEvent(this.fileObj,"click",(function(){this.value=""}))},e.prototype.clip=function(e,t){var n=this;this.fileObj=e.srcElement;var o=e.target.files||e.dataTransfer.files;if(!o.length)return!1;this.initilize(t),this.picValue=o[0],console.log("压缩前this.picValue",this.picValue),ce.a.getData(o[0],(function(){n.Orientation=ce.a.getTag(o[0],"Orientation"),console.log("Exif,self.Orientation",n.Orientation)})),this.originUrl=this.getObjectURL(this.picValue),console.log("this.originUrl",this.originUrl),this.cropper&&this.cropper.replace(this.originUrl)},e.prototype.getObjectURL=function(e){var t=null;return void 0!=window.createObjectURL?t=window.createObjectURL(e):void 0!=window.URL?t=window.URL.createObjectURL(e):void 0!=window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t},e.prototype.crop=function(){var e,t,n=this,o=new Image;document.querySelector(".crop_loading").style.display="block",setTimeout((function(){e=n.cropper.getCroppedCanvas(),t=n.getRoundedCanvas(e);var a=t.toDataURL();if(console.log("imgData",a,a.length),o.src=a,a.length<102400){n.resultObj.src=a;var r=n.dataURLtoFile(a,n.picValue.name);n.postImg(r,a)}else o.onload=function(){console.log("self.Orientation",n.Orientation);var e=n.compress(o,n.Orientation);n.resultObj.src=e;var t=n.dataURLtoFile(e,n.picValue.name);n.postImg(t,e)}}),20)},e.prototype.getRoundedCanvas=function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),o=e.width,a=e.height;return t.width=o,t.height=a,n.imageSmoothingEnabled=!0,n.drawImage(e,0,0,o,a),n.globalCompositeOperation="destination-in",n.beginPath(),n.rect(0,0,o,a),n.fill(),t},e.prototype.dataURLtoFile=function(e,t){var n=e.split(","),o=n[0].match(/:(.*?);/)[1],a=atob(n[1]),r=a.length,i=new Uint8Array(r);while(r--)i[r]=a.charCodeAt(r);return new File([i],t,{type:o})},e.prototype.destoried=function(){this.removeEvent(this.clickBtn,"click",null),this.removeEvent(this.btnRotate,"click",null),this.removeEvent(this.cancelBtn,"click",null),this.removeEvent(this.fileObj,"click",null),this.reagion.parentNode.removeChild(this.reagion),this.cropper.destroy(),this.cropper=null},e.prototype.postImg=function(e,t){var n=this,o=JSON.parse(window.localStorage.getItem("user")),a=new FormData,r={headers:{"Content-Type":"multipart/form-data"}};a.append("photoImg",e,e.name),a.append("userid",o.id),this.$post("users/savePhoto",a,r).then((function(e){console.log("users/savePhoto",e),0==e.code&&(o.photosrc=e.photosrc),window.localStorage.setItem("user",JSON.stringify(o)),document.querySelector(".crop_loading").style.display="none",document.querySelector(".crop_success").style.display="block",n.destoried()}))},e.prototype.rotateImg=function(e,t,n){var o=0,a=3;if(null!=e){var r=e.height,i=e.width,c=2;null==c&&(c=o),"right"==t?(c++,c>a&&(c=o)):"right2"==t?c=2:(c--,c<o&&(c=a));var s=90*c*Math.PI/180;alert("degree:".concat(s,"       step:").concat(c));var u=n.getContext("2d");switch(c){case 0:n.width=i,n.height=r,u.drawImage(e,0,0,i,r);break;case 1:n.width=r,n.height=i,u.rotate(s),u.drawImage(e,0,-r,i,r);break;case 2:n.width=i,n.height=r,u.rotate(s),u.drawImage(e,-i,-r,i,r);break;case 3:n.width=r,n.height=i,u.rotate(s),u.drawImage(e,-i,0,i,r);break}}},e.prototype.compress=function(e,t){var n,o,a=document.createElement("canvas"),r=a.getContext("2d"),i=document.createElement("canvas"),c=i.getContext("2d"),s=e.src.length,u=e.width,l=e.height;if((n=u*l/4e6)>1?(console.log("大于400万像素"),n=Math.sqrt(n),u/=n,l/=n):n=1,a.width=u,a.height=l,r.fillStyle="#fff",r.fillRect(0,0,a.width,a.height),(o=u*l/1e6)>1){o=~~(Math.sqrt(o)+1);var d=~~(u/o),h=~~(l/o);i.width=d,i.height=h;for(var p=0;p<o;p++)for(var f=0;f<o;f++)c.drawImage(e,p*d*n,f*h*n,d*n,h*n,0,0,d,h),r.drawImage(i,p*d,f*h,d,h)}else r.drawImage(e,0,0,u,l);var m=a.toDataURL("image/jpeg",.1);return console.log("压缩前："+s),console.log("压缩后："+m.length),console.log("压缩率："+~~(100*(s-m.length)/s)+"%"),i.width=i.height=a.width=a.height=0,m},e.prototype.addEvent=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},e.prototype.removeEvent=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)}}};p["a"].use(K.a),p["a"].use(Q.a,{name:"v-touch"}),Y.a.attach(document.body),p["a"].prototype.$get=ne,p["a"].prototype.$post=oe,p["a"].use(se),p["a"].use(h["a"]),p["a"].use(d["a"]),p["a"].use(l["a"]),p["a"].use(u["a"]),p["a"].use(s["a"]),p["a"].use(c["a"]),p["a"].use(i["a"]),p["a"].use(r["a"]),p["a"].use(a["a"]),p["a"].use(o["a"]),p["a"].config.productionTip=!1,p["a"].directive("focus",{update:function(e){e.focus()}}),new p["a"]({router:C,store:G,render:function(e){return e(x)}}).$mount("#app")},"5c0b":function(e,t,n){"use strict";var o=n("37c7"),a=n.n(o);a.a},9703:function(e,t,n){},a24a:function(e,t,n){},d2ea:function(e,t,n){"use strict";var o=n("9703"),a=n.n(o);a.a}});